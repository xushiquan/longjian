<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <title>title</title>
    <style>
    	#container{
    		background:transparent;
    	}
    	.groups-title{
    		position:relative;
    		display:block;
    		width:100%;
    		height:36px;
    		background: rgba(33,46,65,0.65);
    		color:#FFFFFF;
    		text-align:center;
    		line-height: 36px;
    	}
    	#container ul{
    		background:transparent !important;
    	}
    	#container ul li{
    		background:transparent !important;
    	}
    </style>
</head>
<body>
	<script id="list-template" type="text/x-dot-template">
		{{ for (var x in it) { }}
		
			<ul class="aui-list-view aui-grid-view">
			{{ for(var i=0;i<it[x].length;i++) { }}
				<li id={{="video"+i}} class="aui-list-view-cell aui-img aui-col-xs-6" tapmode onclick="openWin('{{=x}}',{{=i}})">
		            {{? it[x][i].status==='在线'}}
		            <img class="aui-img-object" src={{=it[x][i].title}} onerror="this.src='../../image/common/videoonline.png'">
		             {{??}}
		            <img class="aui-img-object" src={{=it[x][i].title}} onerror="this.src='../../image/common/videooffline.png'">
		             {{?}}
		            <div class="aui-img-body">
		            	{{=it[x][i].title}}
		            </div>
		        </li>
		    {{ } }}
		    </ul>
		{{ } }}
	</script>
	<div id="container">
    </div>
</body>
<script type="text/javascript" src="../../script/zepto.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/reiz.js"></script>
<script type="text/javascript">
	var datas;

	apiready = function(){

		datas = api.pageParam;

	/*	datas = {"未分组":
[{"deptCode":"60000001","gmtCreate":"2019-06-28 10:07:03","gmtModify":"2019-06-28 10:07:03","isPush":"1","manufacturer":"HK","sn":"60000001-2617354432","status":"在线","title":"大华154","vfrom":"activemq"},
{"channel":36,"deptCode":"60000001","gmtCreate":"2019-06-28 10:07:03","gmtModify":"2019-06-28 10:07:03","id":21,"isPush":"1","manufacturer":"HK","sn":"60000001-2617354432","status":"在线","title":"海康189","vfrom":"activemq"},
{"channel":37,"deptCode":"60000001","gmtCreate":"2019-06-28 10:07:03","gmtModify":"2019-06-28 10:07:03","id":22,"isPush":"1","manufacturer":"HK","sn":"60000001-2617354432","status":"在线","title":"MobileDome","vfrom":"activemq"}]
	};
			"未分组":[{"status":"在线","title":"大门"},{"status":"在线","title":"建筑1"},{"status":"在线","title":"建筑2"},
		{"status":"离线","title":"建筑3"},{"status":"在线","title":"建筑4"}]
		*/
		getxieyi();
	};

	function getxieyi(){
		var testurl = $reiz.urls["video"].getxieyi;
		var userName = api.getPrefs({
			sync : true,
			key : 'loginInfo'
		});
		var user=JSON.parse(userName);
		var usern=user.username;
		console.log(JSON.stringify(datas));
		$('.aui-img-object').css('height',api.winWidth/3+'px');
		$("#container").html(doT.template($("#list-template").text())(datas));

		$reiz.request.post($reiz.urls['video'].getxieyi, {
			body: {
				values : {
					data : usern
				}
			}
		}, function (ret, err) {
				var zt=ret.zhuangtai;
				if(zt=="false"){
	                api.execScript({
		               script: 'openxieyi();'
	                });
				}
				$('.aui-img-object').css('height',api.winWidth/3+'px');
				$("#container").html(doT.template($("#list-template").text())(datas));
		})
		// api.ajax({
		// 	url : $reiz.urls["video"].getxieyi,
		// 	method : 'post',
		// 	data : {
		// 		values : {
		// 			data : usern
		// 		}
		// 	}
		// }, function(ret, err) {
		// 	var zt=ret.zhuangtai;
		// 	if(zt=="false"){
    //             api.execScript({
	  //              script: 'openxieyi();'
    //             });
		// 	}
		// 	$('.aui-img-object').css('height',api.winWidth/3+'px');
		// 	$("#container").html(doT.template($("#list-template").text())(datas));
		// });
	}

	function openWin(key,num){
		var index = num<datas[key].length?num:0;
		var visionData = JSON.stringify(datas[key][index]);
		console.log("visionData=== "+visionData);
	//	console.log("visionData=== "+datas[key][index].isPush);
		if(datas[key][index].isPush==1){
			api.openWin({
	          name: 'vplayer',
		        url: './vplayer.html',
		        pageParam: visionData,
		        slidBackEnabled: false
            });
		}else{
			api.openWin({
		        name: 'androidplayer',
		        url: './video_monitor_androidplayer.html',
		        pageParam: datas[key][index],
		        slidBackEnabled: false
	        });
		}
	}
</script>
</html>
