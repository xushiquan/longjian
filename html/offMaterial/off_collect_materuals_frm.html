
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>收料页面</title>
    	<link rel="stylesheet" type="text/css" href="../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<style>
    .twoNum{
      letter-spacing: 15px
    }
	  select{
	        text-indent: 5px;
	  }
    .carImg{
      color: #212121;
      width: 35%;
      min-width: 1.5rem;
      margin: 0;
      padding: 0;
      padding-right: 0.25rem;
      line-height: 2.2rem;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      max-width: 100%;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      display: -webkit-box;
      display: -webkit-flex;
      display: flex;
      -webkit-align-items: center;
      align-items: center;
    }
    .inp{
      border: none;
      background-color: transparent;
      border-radius: 0;
      box-shadow: none;
      display: block;
      padding: 0;
      margin: 0;
      width: 100%;
      height: 2.2rem;
      line-height: normal;
      color: #424242;
      font-size: 0.8rem;
      font-family: inherit;
      box-sizing: border-box;
      -webkit-user-select: text;
      user-select: text;
      -webkit-appearance: none;
      appearance: none;
    }
		.k{
			min-height: 2.2rem;
			line-height:45px;
			padding:0 5px;

		}
		.kInp{
			flex:1;
			min-height: 2.2rem;
		 	line-height:45px;
			padding: 0 3px;
		}
		.delmb{
			width:80%;
			margin:20px auto;
		}
		.xrequired:before{
			content:"* ";
			color:red;
		}
		</style>
	</head>
	<body>
  <div class="aui-content aui-margin-b-15">
       <ul class="aui-list aui-form-list">
			<li class="aui-list-item">
				<div class="aui-list-item-inner">
						<div class="aui-list-item-label">
								分项工程
						</div>
						<div class="aui-list-item-input" >
							<select disabled="disabled"  class='projectCode' name='projectCode'>
							</select>
						</div>
							<i style='margin-right:0.52rem;color:#09B3EB;' class="aui-iconfont aui-icon-down"></i>
				</div>
			</li>
         <li class="aui-list-item">
           <div class="aui-list-item-inner">
               <div class="aui-list-item-label">
                   司&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp机
               </div>
               <div class="aui-list-item-input">
                   <input disabled="disabled" type="text" name='driverName'>
               </div>
           </div>
       </li>
			 <li class="aui-list-item">
 				<div class="aui-list-item-inner">
 						<div class="aui-list-item-label">
 								 司机电话
 						</div>
 						<div class="aui-list-item-input">
 								<input disabled="disabled" type="text" name='driverMobile'>
 						</div>
 				</div>
 			</li>
       <li class="aui-list-item">
         <div class="aui-list-item-inner">
             <div class="aui-list-item-label">
                  车&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp号
             </div>
             <div class="aui-list-item-input">
                 <input disabled="disabled" type="text" name='carNo'>
             </div>
         </div>
     </li>
     <li class="aui-list-item">
       <div class="aui-list-item-inner">
           <div class="aui-list-item-label">
                车&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp长
           </div>
           <div class="aui-list-item-input">
               <input disabled="disabled" type="text" name='carLength'>
           </div>
       </div>
   </li>
   <li class="aui-list-item">
     <div class="aui-list-item-inner">
         <div class="aui-list-item-label">
              车&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp宽
         </div>
         <div class="aui-list-item-input">
             <input disabled="disabled" type="text" name='carWidth' >
         </div>
     </div>
   </li>
   <li class="aui-list-item">
     <div class="aui-list-item-inner">
         <div class="aui-list-item-label">
              车&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp高
         </div>
         <div class="aui-list-item-input">
             <input disabled="disabled" type="text" name='carHeight'>
         </div>
     </div>
  </li>
  <li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
             加&nbsp&nbsp高&nbsp&nbsp后
        </div>
        <div class="aui-list-item-input">
            <input disabled="disabled" type="text" name='addHeight'>
        </div>
    </div>
  </li>
  <li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
             标准体积
        </div>
        <div class="aui-list-item-input">
            <input disabled="disabled" type="text" name='standardVolume'>
        </div>
    </div>
  </li>
  <li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
            物料名称
        </div>
        <div class="aui-list-item-input">
   					<input disabled="disabled" type="text" disabled="disabled" name='name'>
        </div>
    </div>
  </li>
	<li class="aui-list-item">
 	 <div class="aui-list-item-inner">
 			 <div class="aui-list-item-label">
 						供&nbsp&nbsp应&nbsp&nbsp商
 			 </div>
 			 <div class="aui-list-item-input">
 					 <input disabled="disabled" type="text" disabled="disabled" name='supplier'>
 			 </div>
 	 </div>
  </li>
	<li class="aui-list-item">
	 <div class="aui-list-item-inner">
			 <div class="aui-list-item-label">
						物料规格
			 </div>
			 <div class="aui-list-item-input">
					 <input disabled="disabled" type="text" name='materialStandard'>
			 </div>
	 </div>
	</li>
	<li class="aui-list-item">
	 <div class="aui-list-item-inner">
			 <div class="aui-list-item-label">
						物料型号
			 </div>
			 <div class="aui-list-item-input">
					 <input disabled="disabled" type="text" name='materialType'>
			 </div>
	 </div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
			<div class="aui-list-item-label">
				支线距离
			</div>
			<div class="aui-list-item-input">
				<input disabled="disabled" type="text" name='distance'>
			</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 发料数量
				</div>
				<div class="aui-list-item-input">
					   <input disabled="disabled" type="text" name='quantity' >
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 发&nbsp&nbsp料&nbsp&nbsp地
				</div>
				<div class="aui-list-item-input">
						<input disabled="disabled" type="text" name='origin'>
				</div>
		</div>
	</li>
	<li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
             发料员账号
        </div>
        <div class="aui-list-item-input">
            <input disabled="disabled" type="text" name='consignorId'>
        </div>
    </div>
  </li>

	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 发料员电话
				</div>
				<div class="aui-list-item-input">
						<input disabled="disabled" type="text" name='consignorMobike'>
				</div>
		</div>
	</li>

  <li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
             上路桩号
        </div>
        <div class="aui-list-item-input" style='display:flex;'>
           <span class='k'>k</span>
           <span class='kInp'>
             <input disabled="disabled" type="text" name='loadStakeNum'>
           </span>
           <span class='k'>+</span>
           <span class='kInp'>
           	  <input disabled="disabled" type="text" name='loadStakeNumMeter'>
           </span>
					 <span class='k'>米</span>
        </div>
    </div>
  </li>
	<li class="aui-list-item">
    <div class="aui-list-item-inner">
        <div class="aui-list-item-label">
             发料地桩号
        </div>
        <div class="aui-list-item-input" style='display:flex;'>
           <span class='k'>k</span>
           <span class='kInp'>
             <input disabled="disabled" type="text" name='originStakeNum'>
           </span>
           <span class='k'>+</span>
           <span class='kInp'>
           	  <input disabled="disabled" type="text" name='originStakeNumMeter'>
           </span>
					 <span class='k'>米</span>
        </div>
    </div>
  </li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 发料备注
				</div>
				<div class="aui-list-item-input">
						<textarea disabled="disabled" class='deliveryRemark' name='deliveryRemark' rows="3" cols="20" ></textarea>
				</div>
		</div>
	</li>
	
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 状&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp态
				</div>
				<div class="aui-list-item-input">
					  <input disabled="disabled" type="text" name='status'>
				</div>
		</div>
	</li>
	<!-- 111 -->
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 调整后数量
				</div>
				<div class="aui-list-item-input">
						 <input type="text" name='adjustQuantity' placeholder="请输入调整后数量">
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 运距调整
				</div>
				<div class="aui-list-item-input">
						<input type="number" name='adjustDistance' class='adjustDistance' placeholder="请输入调整后支线距离（公里）">
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 收料时间
				</div>
				<div class="aui-list-item-input">
						<input disabled="disabled" type="text" name='receipttime'>
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label xrequired">
						 收&nbsp&nbsp料&nbsp&nbsp地
				</div>
				<div class="aui-list-item-input">
						<input type="text" name='receiving' placeholder="请输入收料地">
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label xrequired">
						 收料地桩号
				</div>
				<div class="aui-list-item-input" style='display:flex;'>
					 <span class='k'>k</span>
					 <span class='kInp'>
						 <input type="text" name='receivingStakeNum'>
					 </span>
					 <span class='k'>+</span>
					 <span class='kInp'>
							<input type="text" name='receivingStakeNumMeter'>
					 </span>
					 <span class='k'>米</span>
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 收料备注
				</div>
				<div class="aui-list-item-input">
						<textarea class='receiptRemark' name='receiptRemark' rows="3" cols="20" placeholder="请输入收料备注"></textarea>
				</div>
		</div>
	</li>
	<li class="aui-list-item">
		<div class="aui-list-item-inner">
				<div class="aui-list-item-label">
						 微调备注
				</div>
				<div class="aui-list-item-input">
						<textarea class='adjustRemark' name='adjustRemark' rows="3" cols="20" placeholder="请输入微调备注"></textarea>
				</div>
		</div>
	</li>
</ul>

</div>

	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/zepto.js"></script>
	<script type="text/javascript" src="../../script/reiz.js"></script>
	<script type="text/javascript">
	  var account;//用户名 也可以缓存里取
		var username;
		var projectCode;
		var paramsId;//提交需要的id参数

		 apiready = function() {
			 //页面打开带过来的参数
				var paramsName = api.pageParam.name;
				var carNo = api.pageParam.carNo;

				api.getPrefs({
		 		key : 'loginInfo'
		 	 }, function(ret, err) {
		 		 if(ret.value){
		 			 var loginInfo = JSON.parse(ret.value);
		 			 account = loginInfo.account;
					 username = loginInfo.name;

					 changeTitle(username);
					 //projectList(loginInfo.account);
					 projectCode = loginInfo.projects.projectCode;
					 projectOneList();
					 	//收料信息
		 			 receiveWaybill(loginInfo.account,loginInfo.projects.projectCode);

		 		 }
		 	 });
		}

		function changeTitle(arg) {
			api.execScript({
				winName: 'collect_materuals_win',
				script: 'changeTitle("' + arg + '");'
			});
		}
		//收料信息post
		function receiveWaybill(account,projectCode){
				$reiz.request.post($reiz.urls['material'].receiveWaybill, {
					body:{
						"carNo":api.pageParam.carNo,
						"account":account,
						"projectCode":projectCode,
					}
				},function(ret,error){
					if(ret.code !=400){
						paramsId = 	ret.waybill.id;
						var vehicle = ret.vehicle;
						var material = ret.material;
						var waybill = ret.waybill;
						$('.projectCode').val(vehicle.projectCode);
						$("input[name='driverName']").val(ret.driverName || '未知');
						$("input[name='driverMobile']").val(vehicle.driverMobile || '未知');
						$("input[name='carNo']").val(vehicle.carNo || '未知');
						$("input[name='carLength']").val(vehicle.carLength || '未知');
						$("input[name='carWidth']").val(vehicle.carWidth || '未知');
						$("input[name='carHeight']").val(vehicle.carHeight || '未知');
						$("input[name='addHeight']").val(vehicle.addHeight || '未知');
						$("input[name='standardVolume']").val(vehicle.standardVolume || '未知');

						$("input[name='name']").val(material.name || '未知');
						$("input[name='supplier']").val(material.supplier || '未知');
						$("input[name='materialStandard']").val(material.materialStandard || '未知');
						$("input[name='materialType']").val(material.materialType || '未知');
						$("input[name='distance']").val(waybill.distance || '未知');

						
						$("input[name='receipttime']").val(waybill.receipttime || '未知');
						$("input[name='origin']").val(waybill.origin || '未知');
						$("input[name='consignorId']").val(waybill.consignorId || '未知');
						$("input[name='consigneeId']").val(waybill.consigneeId || '未知');
						$("input[name='consignorMobike']").val(ret.consignorMobike || '未知');
						
						$("input[name='loadStakeNum']").val(waybill.loadStakeNum || '未知');
						$("input[name='loadStakeNumMeter']").val(waybill.loadStakeNumMeter || '未知');
						$("input[name='originStakeNum']").val(waybill.originStakeNum || '未知');
						$("input[name='originStakeNumMeter']").val(waybill.originStakeNumMeter || '未知');
						$("input[name='receiving']").val(waybill.receiving || '');
						$("input[name='receivingStakeNum']").val(waybill.receivingStakeNum || '');
						$("input[name='receivingStakeNumMeter']").val(waybill.receivingStakeNumMeter || '');

						$('.deliveryRemark').val(waybill.deliveryRemark);
						$('.receiptRemark').val(waybill.receiptRemark)
						$("input[name='quantity']").val(waybill.quantity || '未知');
						if(waybill.status =='0'){
								$("input[name='status']").val('已发货');
						}else if(waybill.status =='1'){
								$("input[name='status']").val('已收货');
						}else if(waybill.status =='2'){
								$("input[name='status']").val('退回');
						}else if(waybill.status =='3'){
								$("input[name='status']").val('审核中');
						}else if(waybill.status =='4'){
								$("input[name='status']").val('已审核');
						}
					}else{
						alert(ret.msg);
						//alert(date.msg);
						api.closeWin();

					}

					// $("input[name='adjustQuantity']").val(waybill.adjustQuantity);
				})
		}

		function submit(){
			var receiving = $("input[name='receiving']").val();
			if(receiving == ""){
				api.toast({
						msg: '请输入收料地',
						duration: 2000,
						location: 'bottom'
				});
				return;
			}

			var receivingStakeNum = $("input[name='receivingStakeNum']").val();
			var receivingStakeNumMeter = $("input[name='receivingStakeNumMeter']").val();

			if(receivingStakeNum == "" || receivingStakeNumMeter == ""){
				api.toast({
						msg: '收料地桩号不能为空',
						duration: 2000,
						location: 'bottom'
				});
				return;
			}
			$reiz.request.post($reiz.urls['material'].confirmWaybill, {
					body:{
						account:account,
						id:paramsId,
						receiving:$("input[name='receiving']").val(),//收料地
						receivingStakeNum:$("input[name='receivingStakeNum']").val(),//收料地桩号
						receivingStakeNumMeter:$("input[name='receivingStakeNumMeter']").val(),		//收料地桩号   加号后数字
						adjustQuantity:$("input[name='adjustQuantity']").val(),//调整后收货数量
						adjustDistance:$("input[name='adjustDistance']").val(),//调整后距离
						adjustRemark:$(".adjustRemark").val(),//微调备注
						receiptRemark:$(".receiptRemark").val(),//收货备注
					}
			},function(ret,error){

					if(ret.code == 200){
						api.alert({
									title: '提示消息',
									msg: ret.msg,
							}, function(ret, err) {
								api.execScript({
									name: 'material',
									frameName: 'material_list_frame',
									script:  'getMaterialList(1);'
								});
								api.closeWin();
							});

					}else{
						api.toast({
								msg: ret.msg,
								duration: 2000,
								location: 'middle'
						});
					}

			})
		}
		//项目下拉
		function projectList(account){
			$reiz.request.get($reiz.urls['project'].querylist, {
				body:{
						account:account
				}
			},function(ret,error){
					if(ret.code == 200){
						var data = JSON.parse(ret.data);
							for(var i=0; i<data.length;i++){
								$('.projectCode').append('<option value='+data[i].projectCode+'>'+data[i].projectName+'</option>')
							}
					}
			})
		}

		function projectOneList(){
			 $reiz.request.post($reiz.urls['project'].projectOne, {
				 body:{
					"projectCode":projectCode
				 }
			 },function(ret,error){
					if(ret.code == 200){
						var data = JSON.parse(ret.data);
						for(var i=0; i<data.length;i++){
							$('.projectCode').append('<option value='+data[i].projectCode+'>'+data[i].projectName+'</option>')
						}
					}
			 })
		}

	</script>
</html>
